<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Electro Shop ‚Äì Full Web App</title>

<style>
body{margin:0;font-family:Arial;background:#0f2027;color:#fff}
header,footer{text-align:center;padding:15px;background:#000}
.container{padding:15px}
.box{background:#fff;color:#000;padding:15px;border-radius:12px;margin-bottom:15px}
input,textarea{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
button{width:100%;padding:10px;border:none;border-radius:8px;background:#000;color:#fff;margin-top:5px}
.hidden{display:none}
.product{background:#fff;color:#000;border-radius:15px;margin-bottom:15px;overflow:hidden}
.slider img{width:100%;height:200px;object-fit:cover}
.pcon{padding:12px}
.price{color:green;font-weight:bold}
.buy{background:#ff9800}
.review{background:#f1f1f1;padding:6px;border-radius:6px;margin-top:6px}
.stat{background:#2196f3;color:#fff;padding:8px;border-radius:8px;margin:5px 0;text-align:center}
</style>

<!-- Firebase Setup -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBQrlvnSaJxmt5nAxlfw-zqcdNVg1Weayo",
  authDomain: "electro-shop-f2fb6.firebaseapp.com",
  projectId: "electro-shop-f2fb6",
  storageBucket: "electro-shop-f2fb6.appspot.com",
  messagingSenderId: "951630205122",
  appId: "1:951630205122:web:c1615128e3013ab4f52b5b"
};

const app = initializeApp(firebaseConfig);
window.auth = getAuth(app);
window.db = getFirestore(app);
window.storage = getStorage(app);

// Recaptcha Setup
window.setupRecaptcha = function(containerId){
  window.recaptchaVerifier = new RecaptchaVerifier(containerId, { 'size':'invisible' }, auth);
}

// Send OTP
window.sendOTP = function(phoneNumber, callback){
  signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier)
    .then(confirmationResult=>{
      window.confirmationResult = confirmationResult;
      callback(null,"OTP Sent");
    }).catch(err=>callback(err,null));
}

// Verify OTP
window.verifyOTP = function(code, callback){
  window.confirmationResult.confirm(code)
    .then(res=>callback(null,res.user))
    .catch(err=>callback(err,null));
}

</script>
</head>
<body>
<header><h1>üõí Electro Shop</h1></header>

<div class="container">

<!-- Buyer Login -->
<div class="box" id="buyerBox">
<h3>üë§ Buyer Login / Profile</h3>
<input id="phone" placeholder="Mobile Number">
<div id="recaptcha"></div>
<button onclick="setupRecaptcha('recaptcha');sendOTP('+91'+phone.value,(e,s)=>alert(s||e.message))">Send OTP</button>
<input id="otp" placeholder="Enter OTP">
<button onclick="verifyOTP(otp.value,(e,u)=>{if(u){alert('Login Success'); buyerBox.classList.add('hidden'); addBox.classList.remove('hidden');}})">Verify OTP</button>
</div>

<!-- Seller Add Product -->
<div class="box hidden" id="addBox">
<h3>‚ûï Add Product</h3>
<input id="pName" placeholder="Product Name">
<input id="pPrice" placeholder="Price">
<textarea id="pDesc" placeholder="Description"></textarea>
<input type="file" id="pImgs" accept="image/*" multiple>
<button onclick="addProduct()">Post Product</button>
</div>

<!-- Products -->
<div id="products"></div>

<!-- Orders / Tracking -->
<div class="box">
<h3>üöö Track Order</h3>
<input id="trackId" placeholder="Enter Tracking ID">
<button onclick="track()">Track</button>
<p id="trackStatus"></p>
</div>

<!-- Orders History -->
<div class="box">
<h3>üì¶ Order History</h3>
<div id="orders"></div>
</div>

</div>
<footer>¬© Electro Shop</footer>

<script>
// Simple localStorage fallback
let products=JSON.parse(localStorage.getItem('products'))||[];
let orders=JSON.parse(localStorage.getItem('orders'))||[];

function addProduct(){
  const imgs=[];
  const files=pImgs.files;
  let loaded=0;
  for(let f of files){
    const r=new FileReader();
    r.onload=e=>{
      imgs.push(e.target.result);
      loaded++;
      if(loaded===files.length){
        const id=Date.now();
        products.push({id,pName:pName.value,pDesc:pDesc.value,pPrice:pPrice.value,imgs,reviews:[]});
        localStorage.setItem('products',JSON.stringify(products));
        render();
      }
    };
    r.readAsDataURL(f);
  }
}

function render(){
  productsDiv.innerHTML='';
  products.forEach(p=>{
    productsDiv.innerHTML+=`
    <div class='product'>
      <div class='slider'>${p.imgs.map(i=>`<img src='${i}'>`).join('')}</div>
      <div class='pcon'>
        <h3>${p.pName}</h3>
        <p>${p.pDesc}</p>
        <p class='price'>‚Çπ${p.pPrice}</p>
        <button class='buy' onclick='buy(${p.id})'>Buy (COD / UPI)</button>
        <div id='reviews-${p.id}'>${p.reviews.map(r=>`<div class='review'>${r}</div>`).join('')}</div>
        <textarea id='rev-${p.id}' placeholder='Write review'></textarea>
        <button onclick='addReview(${p.id})'>‚≠ê Add Review</button>
      </div>
    </div>`;
  });
  updateDash();
}

function addReview(id){
  const txt=document.getElementById('rev-'+id).value;
  if(!txt) return;
  let p=products.find(x=>x.id===id);
  p.reviews.push(txt);
  localStorage.setItem('products',JSON.stringify(products));
  render();
}

function buy(id){
  const t='ES'+Math.floor(Math.random()*99999);
  orders.push({id,track:t,status:'Packed'});
  localStorage.setItem('orders',JSON.stringify(orders));
  alert('Order placed. Tracking ID: '+t);
  renderOrders();
}

function track(){
  const o=orders.find(o=>o.track===trackId.value);
  trackStatus.innerText=o?('Status: '+o.status):'Not found';
}

function renderOrders(){
  ordersDiv.innerHTML='';
  orders.forEach(o=>ordersDiv.innerHTML+=`<p>${o.track} - ${o.status}</p>`)
}

function updateDash(){
  // seller stats placeholder
}

render(); renderOrders();
</script>
</body>
</html>